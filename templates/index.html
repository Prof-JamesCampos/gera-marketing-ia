<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gera Marketing com IA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Gera Marketing com IA üöÄ</h1>
        <form id="marketing-form">
            <div class="form-group">
                <label for="produto">Nome do Produto:</label>
                <input type="text" id="produto" placeholder="Ex: Fone de ouvido" required>
            </div>
            <div class="form-group">
                <label for="caracteristicas">Principais Caracter√≠sticas:</label>
                <textarea id="caracteristicas" rows="3" placeholder="Ex: Bateria de 30h" required></textarea>
            </div>
            <div class="form-group">
                <label for="publico">P√∫blico-alvo:</label>
                <input type="text" id="publico" placeholder="Ex: Profissionais" required></div>
            <button type="submit" id="btn-gerar">Gerar Texto</button>
        </form>
        <div id="resultado"></div>
    </div>

    <script>
        // Parse adaptado para a resposta da IA
        const form = document.getElementById('marketing-form');
        const resultadoDiv = document.getElementById('resultado');
        const botao = document.getElementById('btn-gerar');

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const produto = document.getElementById('produto').value;
            const caracteristicas = document.getElementById('caracteristicas').value;
            const publico = document.getElementById('publico').value;
            botao.disabled = true;
            botao.innerText = 'Gerando...';
            resultadoDiv.style.display = 'none';
            resultadoDiv.innerHTML = '';
            resultadoDiv.classList.remove('visivel');

            try {
                const response = await fetch('/gerar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ produto, caracteristicas, publico })
                });

                const data = await response.json();

                if (response.ok) {
                    const textoBruto = data.texto_marketing;
                    const htmlLines = [];
                    const linhas = textoBruto.split('\n');

                    // Fun√ß√£o auxiliar para aplicar negrito e it√°lico
                    const formatarLinha = (texto) => {
                        if (!texto) return '';
                        return texto
                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                            .replace(/\*(.*?)\*/g, '<em>$1</em>');
                    };

                    linhas.forEach(linha => {
                        const linhaTrimmed = linha.trim();
                        if (!linhaTrimmed) return; 

                        if (linhaTrimmed === '---') {
                            htmlLines.push('<hr>');
                        } else if (linhaTrimmed.toUpperCase().startsWith('**T√çTULO:**')) {
                            let conteudo = linhaTrimmed.substring('**T√çTULO:**'.length).trim();
                            htmlLines.push(`<h3>${formatarLinha(conteudo)}</h3>`);
                        } else if (linhaTrimmed.toUpperCase().startsWith('**TEXTO:**')) {
                            
                        } else {
                            htmlLines.push(`<p>${formatarLinha(linhaTrimmed)}</p>`);
                        }
                    });

                    resultadoDiv.innerHTML = htmlLines.join('');

                } else {
                    resultadoDiv.innerHTML = `<h3>Ocorreu um Erro</h3><p>${data.erro}</p>`;
                }

            } catch (error) {
                resultadoDiv.innerHTML = `<h3>Erro de Conex√£o</h3><p>N√£o foi poss√≠vel conectar ao servidor. Verifique o terminal onde o Python est√° rodando. Detalhe: ${error}</p>`;
            } finally {
                if (resultadoDiv.innerHTML !== '') {
                    resultadoDiv.style.display = 'block'; 
                    setTimeout(() => {
                        resultadoDiv.classList.add('visivel');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 20);
                }
                botao.disabled = false;
                botao.innerText = 'Gerar Texto';
            }
        });
    </script>
</body>
</html>